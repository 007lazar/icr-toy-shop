<nav
	class="navbar fixed-top navbar-expand-lg bg-transparent border-info border-opacity-25 border-4 rounded-4 shadow-sm">
	<div class="container-fluid align-items-center">


		<!-- LEFT: Logo + Brand -->
		<a class="navbar-brand d-flex align-items-center gap-2 brand-wrap" routerLink="/">
			<img class="brand-logo"
				src="https://static.vecteezy.com/system/resources/thumbnails/021/769/115/small/toys-logo-free-vector.jpg"
				width="45" height="45" alt="Logo" />
			<span class="brand-text fw-bold">ToyShop</span>
		</a>

		<!-- CENTER: Nav links -->
		<div class="mx-auto">
			<ul class="navbar-nav flex-row gap-4 nav-modern">
				<li class="nav-item">
					<a class="nav-link" routerLink="/">Home</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" routerLink="/products">Toys</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" routerLink="/about">About</a>
				</li>
			</ul>
		</div>


		<!-- RIGHT: Auth + Cart -->
		<div class="d-flex align-items-center gap-3">

			<a routerLink="/cart" class="cart-btn position-relative">
				<i class="fa-solid fa-basket-shopping"></i>
			</a>

			@if(!hasAuth()) {
			<a routerLink="/login" class="btn login-btn px-4 py-2 rounded-pill fw-bold">
				Login
			</a>
			} @else {
			<div class="dropdown">
				<button class="btn btn-outline-success dropdown-toggle rounded-pill px-3" data-bs-toggle="dropdown">
					{{getUserName()}}
				</button>
				<ul class="dropdown-menu dropdown-menu-end">
					<li><a class="dropdown-item" routerLink="/profile">My Profile</a></li>
					<li><button class="dropdown-item" (click)="doLogout()">Logout</button></li>
				</ul>
			</div>
			}

		</div>


	</div>
</nav>
<div class="container mt-2 pt-4">
	<router-outlet />

	<!-- Chatbot -->
	<div class="chatbot-container position-fixed bottom-0 end-0 p-3">

		@if (!isChatVisible) {
		<button class="chatbot-btn" (click)="toggleChat()">
			<span class="pulse-ring"></span>
			<i class="fa-solid fa-comment-dots"></i>
		</button>
		<div class="chatbot-label mt-1 text-center">Toy Assistant</div>
		}

		@if (isChatVisible) {
		<div class="chat-window bg-white shadow-lg rounded-4 p-3" style="width: 350px; max-width: 90vw;">
			<div class="d-flex justify-content-between align-items-center mb-3">
				<div class="fw-bold">Toy Assistant</div>
				<button class="btn btn-sm btn-outline-secondary p-1" (click)="toggleChat()">
					<i class="fa-solid fa-xmark"></i>
				</button>
			</div>

			@for (msg of messages; track $index) {}

			<div class="chat-messages mb-3" #chatMessages style="max-height: 300px; overflow-y: auto;">
				@for (msg of messages; track $index) {
				<div class="mb-2 d-flex"
					[ngClass]="{'justify-content-end': msg.type === 'user', 'justify-content-start': msg.type === 'bot'}">

					@if (msg.type === 'bot') {
					<div class="p-2 bg-light text-dark rounded-3 shadow-sm" style="max-width: 80%;">
						@if (msg.text) {
						<div [innerHTML]="msg.text"></div>
						}
						@if (msg.toys?.length) {
						<div class="w-100 d-flex flex-column gap-2 mt-2">
							@for (toy of msg.toys; track toy.toyId) {
							<div class="card shadow-sm border-0 w-100 text-center">
								<img [src]="'https://toy.pequla.com' + toy.imageUrl" [alt]="toy.name"
									class="card-img-top img-fluid p-3" />

								<div class="card-body py-2">
									<div class="fw-semibold mb-1">
										{{ toy.name }}
									</div>
									<div class="text-muted">
										{{ toy.type.name }}
									</div>
									<div class="text-muted">
										{{ toy.ageGroup.name }}
									</div>
									<div class="fw-bold text-primary mt-1">
										{{ toy.price }} RSD
									</div>
									<a class="btn btn-outline-primary btn-sm w-100 mt-2"
										[routerLink]="['/toy/permalink', toy.permalink]" (click)="toggleChat()">
										View
									</a>
								</div>
							</div>
							}
						</div>
						}
					</div>
					}
					@if (msg.type === 'user') {
					<div class="p-2 bg-primary text-white rounded-3 shadow-sm" style="max-width: 80%;">{{ msg.text }}
					</div>
					}
					@if (msg.type === 'error') {
					<div class="text-danger">{{ msg.text }}</div>
					}
				</div>
				}
			</div>

			<div class="input-group">
				<input type="text" class="form-control rounded-pill" [(ngModel)]="userMessage"
					(keydown.enter)="sendUserMessage()" placeholder="Type your message..." />
				<button class="btn btn-primary rounded-pill ms-2" (click)="sendUserMessage()">
					<i class="fa-solid fa-paper-plane"></i>
				</button>
			</div>
		</div>
		}
	</div>

	<div class="text-center text-white mt-3">
		<p>&copy; All right's reserved {{year}} - Toy Shop</p>
	</div>
</div>