<nav aria-label="breadcrumb" class="permalink-breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item">
            <a routerLink="/">Home</a>
        </li>
        <li class="breadcrumb-item">
            <a routerLink="/toys">Toys</a>
        </li>
        <li class="breadcrumb-item active" aria-current="page">
            {{ toy()?.name }}
        </li>
    </ol>
</nav>

<div class="row g-4">
    <div class="col-12 col-md-4">
        <img [src]="toy()?.imageUrl" [alt]="toy()?.name" class="img-fluid rounded shadow-sm">
    </div>
    <div class="col-12 col-md-8">
        <div class="card shadow-sm">
            <div class="card-header product-detail-header">
                <h5>
                    <i class="fa-solid fa-puzzle-piece"></i> {{ toy()?.name }}
                </h5>
            </div>
            <div class="card-body">
                <p>{{ toy()?.description }}</p>

                <div class="row mt-3">
                    <div class="col-12 col-md-6">
                        <h6>Type:</h6>
                        <p>{{ toy()?.type?.name }} - {{ toy()?.type?.description }}</p>
                    </div>
                    <div class="col-12 col-md-6">
                        <h6>Age Group:</h6>
                        <p>{{ toy()?.ageGroup?.name }} - {{ toy()?.ageGroup?.description }}</p>
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col-6">
                        <h6>Target Group:</h6>
                        <p>{{ toy()?.targetGroup }}</p>
                    </div>
                    <div class="col-6">
                        <h6>Production Date:</h6>
                        <p>{{ toy()?.productionDate }}</p>
                    </div>
                </div>

                <div class="product-price">
                    Price: {{ toy()?.price }} <span class="product-price-unit">RSD</span>
                </div>
            </div>


            <div class="card-footer text-center">
                <button class="btn btn-success" (click)="addToCart()">
                    <i class="fa-solid fa-cart-shopping"></i> Add to Cart
                </button>
            </div>
        </div>
    </div>
</div>


<div class="row mt-5">
    <div class="col-12 col-lg-8">

        <div class="card shadow-sm">
            <div class="card-header bg-light d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="fa-solid fa-star text-warning me-2"></i>
                    Customer Reviews
                </h5>

                <span class="badge bg-primary">
                    {{ (reviews()?.length) }} {{ (reviews()?.length ?? 0) === 1 ? 'review' : 'reviews' }}
                </span>
            </div>

            <div class="card-body">

                <!-- Review form -->
                @if (hasUser && hasBoughtThisToy()) {
                <div class="mb-4">
                    <h6 class="fw-semibold mb-2">Your rating</h6>

                    <div class="d-flex align-items-center gap-3 mb-3">
                        <div class="rating-stars">
                            @for (star of [5,4,3,2,1]; track star) {
                            <input type="radio" [id]="'star' + star" name="rating" [value]="star"
                                [(ngModel)]="selectedRating" />
                            <label [for]="'star' + star">
                                <i class="fa-solid fa-star"></i>
                            </label>
                            }
                        </div>

                        @if (selectedRating > 0) {
                        <span class="text-muted small">
                            {{ selectedRating }} / 5
                        </span>
                        }
                    </div>

                    <textarea class="form-control mb-3" rows="3" placeholder="Write your comment..."
                        [(ngModel)]="reviewComment">
                    </textarea>

                    <button class="btn btn-outline-primary btn-sm"
                        [disabled]="selectedRating === 0 || !reviewComment.trim()" (click)="submitReview()">
                        Submit review
                    </button>
                </div>

                <hr>
                } @else if (hasUser){
                <div class="alert alert-info mb-4">
                    Purchase this item to leave a review
                </div>
                } @else {
                <div class="alert alert-info mb-4">
                    Please log in to leave a review.
                </div>
                }

                <!-- Reviews list -->
                @if ((reviews()?.length ?? 0) === 0) {
                <div class="text-muted text-center py-4">
                    No reviews yet. Be the first to review this toy.
                </div>
                } @else {
                @for (review of reviews(); track review.id ?? $index) {
                <div class="review-item mb-4 bg-light">

                    <div class="d-flex justify-content-between align-items-center mb-1">
                        <strong>{{ review.user }}</strong>
                        <small class="text-muted">{{ review.date }}</small>
                    </div>

                    <div class="mb-2 text-warning">
                        @for (s of [].constructor(review.rating); track $index) {
                        <i class="fa-solid fa-star"></i>
                        }
                        <span class="text-muted ms-2 small">{{ review.rating }}/5</span>
                    </div>

                    <p class="mb-0 text-secondary">
                        {{ review.comment }}
                    </p>
                </div>
                }
                }
            </div>
        </div>
    </div>
</div>